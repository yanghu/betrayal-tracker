<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>山中小屋 角色属性追踪器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .stat-value {
            transition: all 0.2s ease-in-out;
        }
        .current-value {
            transform: scale(1.2);
            font-weight: 700;
        }
        .start-value {
            text-shadow: 0 0 8px rgba(34, 197, 94, 0.7);
        }
        .skull-value {
             filter: drop-shadow(0 0 3px rgba(239, 68, 68, 0.7));
        }
        .btn-disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .character-card {
             cursor: pointer;
        }
        .toggle-bg {
            transition: background-color 0.2s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

    <div id="app" class="container mx-auto p-4 max-w-lg">

        <!-- 角色选择界面 -->
        <div id="selection-screen">
            <header class="text-center mb-6">
                <h1 class="text-3xl font-bold text-red-500 tracking-wider">山中小屋</h1>
                <p class="text-xl text-gray-300">角色属性追踪器</p>
            </header>
            <div id="character-list" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <!-- 角色卡片将由JS动态生成 -->
            </div>
        </div>

        <!-- 属性追踪界面 -->
        <div id="tracker-screen" class="hidden">
            <header class="flex items-center justify-between mb-4">
                <button id="back-to-selection" class="text-blue-400 hover:text-blue-300 transition-colors">&lt; 返回选择</button>
                <div class="flex items-center space-x-2">
                    <span id="haunt-label" class="text-gray-400 text-sm transition-colors duration-200">作祟开始?</span>
                    <label for="haunt-toggle" class="flex items-center cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="haunt-toggle" class="sr-only">
                            <div id="haunt-toggle-bg" class="toggle-bg block bg-gray-600 w-10 h-6 rounded-full"></div>
                            <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div>
                        </div>
                    </label>
                </div>
            </header>
            
            <div id="character-header" class="text-center p-4 rounded-lg mb-6">
                <h2 id="character-name" class="text-2xl font-bold"></h2>
            </div>

            <div id="stats-container" class="space-y-4">
                <!-- 属性条将由JS动态生成 -->
            </div>
             <footer class="text-center mt-8">
                <p id="character-status" class="text-xl font-bold text-red-500 h-8"></p>
            </footer>
        </div>
    </div>

    <script>
        // --- 数据定义 ---
        const characters = [
            {
                name: "Darrin Williams (飞毛腿)", color: "border-yellow-500", bgColor: "bg-yellow-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 3, 3, 4, 5, 6, 6, 7], start: 4 },
                    speed:     { name: "速度", scale: ['💀', 4, 4, 4, 5, 6, 7, 7, 8], start: 4 },
                    knowledge: { name: "知识", scale: ['💀', 2, 3, 3, 4, 5, 5, 5, 7], start: 4 },
                    sanity:    { name: "神志", scale: ['💀', 1, 2, 3, 4, 5, 5, 5, 7], start: 4 },
                }
            },
            {
                name: "Ox Bellows (莽撞大汉)", color: "border-red-600", bgColor: "bg-red-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 4, 5, 5, 6, 6, 7, 8, 8], start: 4 },
                    speed:     { name: "速度", scale: ['💀', 2, 2, 2, 3, 4, 5, 5, 6], start: 4 },
                    knowledge: { name: "知识", scale: ['💀', 2, 2, 2, 3, 3, 5, 5, 6], start: 4 },
                    sanity:    { name: "神志", scale: ['💀', 2, 2, 3, 4, 5, 5, 6, 7], start: 4 },
                }
            },
            {
                name: "Prof. Longfellow (睿智教授)", color: "border-green-600", bgColor: "bg-green-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 1, 2, 2, 3, 4, 5, 6, 7], start: 3 },
                    speed:     { name: "速度", scale: ['💀', 2, 3, 3, 4, 5, 6, 7, 8], start: 3 },
                    knowledge: { name: "知识", scale: ['💀', 4, 5, 5, 6, 7, 8, 8, 8], start: 3 },
                    sanity:    { name: "神志", scale: ['💀', 1, 3, 3, 4, 5, 6, 7, 8], start: 3 },
                }
            },
            {
                name: "Father Rhinehardt (莱因哈特神父)", color: "border-gray-400", bgColor: "bg-gray-700",
                stats: {
                    might:     { name: "力量", scale: ['💀', 1, 2, 2, 4, 4, 5, 5, 6], start: 3 },
                    speed:     { name: "速度", scale: ['💀', 2, 3, 3, 4, 5, 6, 7, 7], start: 3 },
                    knowledge: { name: "知识", scale: ['💀', 1, 3, 3, 4, 5, 6, 8, 8], start: 4 },
                    sanity:    { name: "神志", scale: ['💀', 3, 4, 5, 5, 6, 7, 8, 8], start: 5 },
                }
            },
            {
                name: "Brandon Jaspers (阳光少年)", color: "border-indigo-500", bgColor: "bg-indigo-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 3, 3, 4, 5, 6, 7, 8], start: 4 },
                    speed:     { name: "速度", scale: ['💀', 3, 4, 4, 4, 5, 6, 7, 8], start: 3 },
                    knowledge: { name: "知识", scale: ['💀', 1, 3, 3, 5, 5, 6, 6, 7], start: 4 },
                    sanity:    { name: "神志", scale: ['💀', 3, 3, 3, 4, 5, 6, 7, 8], start: 3 },
                }
            },
            {
                name: "Peter Akimoto (日本男孩)", color: "border-teal-500", bgColor: "bg-teal-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 3, 3, 4, 5, 5, 6, 8], start: 3 },
                    speed:     { name: "速度", scale: ['💀', 3, 3, 3, 4, 6, 6, 7, 7], start: 4 },
                    knowledge: { name: "知识", scale: ['💀', 3, 4, 4, 5, 6, 7, 7, 8], start: 3 },
                    sanity:    { name: "神志", scale: ['💀', 3, 4, 4, 5, 6, 6, 7, 8], start: 3 },
                }
            },
            {
                name: "Zoe Ingstrom (古怪女孩)", color: "border-orange-500", bgColor: "bg-orange-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 3, 3, 4, 4, 5, 6, 8], start: 4 },
                    speed:     { name: "速度", scale: ['💀', 3, 3, 4, 4, 4, 5, 6, 8], start: 3 },
                    knowledge: { name: "知识", scale: ['💀', 1, 2, 3, 4, 4, 5, 5, 5], start: 3 },
                    sanity:    { name: "神志", scale: ['💀', 3, 4, 5, 5, 6, 6, 7, 8], start: 2 },
                }
            },
            {
                name: "Missy Dubourde (邻家女孩)", color: "border-pink-500", bgColor: "bg-pink-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 3, 3, 3, 4, 5, 6, 7], start: 3 },
                    speed:     { name: "速度", scale: ['💀', 3, 4, 4, 5, 6, 6, 6, 7], start: 2 },
                    knowledge: { name: "知识", scale: ['💀', 2, 3, 4, 4, 5, 6, 6, 6], start: 3 },
                    sanity:    { name: "神志", scale: ['💀', 1, 2, 3, 4, 5, 5, 6, 7], start: 4 },
                }
            },
            {
                name: "Madame Zostra (占卜师)", color: "border-blue-500", bgColor: "bg-blue-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 3, 3, 4, 5, 5, 6, 7], start: 3 },
                    speed:     { name: "速度", scale: ['💀', 2, 3, 3, 4, 5, 6, 6, 7], start: 4 },
                    knowledge: { name: "知识", scale: ['💀', 1, 3, 4, 4, 4, 5, 6, 7], start: 3 },
                    sanity:    { name: "神志", scale: ['💀', 4, 4, 4, 5, 6, 7, 8, 8], start: 4 },
                }
            },
            {
                name: "Vivian Lopez (拉丁女郎)", color: "border-purple-500", bgColor: "bg-purple-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 2, 2, 4, 4, 5, 6, 6], start: 4 },
                    speed:     { name: "速度", scale: ['💀', 3, 4, 4, 4, 4, 6, 7, 8], start: 3 },
                    knowledge: { name: "知识", scale: ['💀', 4, 5, 5, 5, 5, 6, 6, 8], start: 2 },
                    sanity:    { name: "神志", scale: ['💀', 1, 2, 3, 4, 4, 5, 6, 6], start: 4 },
                }
            },
            {
                name: "Jenny LeClerc (坚强女孩)", color: "border-cyan-500", bgColor: "bg-cyan-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 3, 3, 4, 4, 5, 6, 8], start: 3 },
                    speed:     { name: "速度", scale: ['💀', 2, 3, 4, 4, 4, 5, 6, 8], start: 3 },
                    knowledge: { name: "知识", scale: ['💀', 1, 2, 3, 4, 4, 5, 6, 8], start: 4 },
                    sanity:    { name: "神志", scale: ['💀', 3, 4, 4, 4, 5, 6, 7, 8], start: 5 },
                }
            },
            {
                name: "Heather Granville (高傲贵妇)", color: "border-fuchsia-500", bgColor: "bg-fuchsia-900",
                stats: {
                    might:     { name: "力量", scale: ['💀', 2, 3, 3, 4, 5, 6, 7, 8], start: 3 },
                    speed:     { name: "速度", scale: ['💀', 3, 3, 4, 5, 6, 7, 8, 8], start: 2 },
                    knowledge: { name: "知识", scale: ['💀', 2, 3, 4, 5, 6, 7, 8, 8], start: 4 },
                    sanity:    { name: "神志", scale: ['💀', 2, 3, 3, 4, 5, 6, 7, 8], start: 5 },
                }
            }
        ];

        // --- 应用状态 ---
        let state = {
            selectedCharacterIndex: null,
            hauntStarted: false,
            currentStatIndices: {
                might: 0,
                speed: 0,
                knowledge: 0,
                sanity: 0,
            }
        };

        // --- DOM 元素引用 ---
        const selectionScreen = document.getElementById('selection-screen');
        const trackerScreen = document.getElementById('tracker-screen');
        const characterList = document.getElementById('character-list');
        const characterNameEl = document.getElementById('character-name');
        const characterHeaderEl = document.getElementById('character-header');
        const statsContainer = document.getElementById('stats-container');
        const backButton = document.getElementById('back-to-selection');
        const hauntToggle = document.getElementById('haunt-toggle');
        const hauntToggleBg = document.getElementById('haunt-toggle-bg');
        const hauntLabel = document.getElementById('haunt-label');
        const characterStatusEl = document.getElementById('character-status');
        const hauntToggleDot = document.querySelector('label[for="haunt-toggle"] .dot');


        // --- 渲染函数 ---

        function renderSelectionScreen() {
            characterList.innerHTML = '';
            characters.forEach((char, index) => {
                const card = document.createElement('div');
                card.className = `character-card p-4 rounded-lg transition-all duration-200 transform hover:scale-105 border-2 ${char.color} ${char.bgColor}`;
                card.dataset.index = index;
                card.innerHTML = `<h3 class="font-bold text-center text-lg">${char.name}</h3>`;
                characterList.appendChild(card);
            });
        }

        function renderTrackerScreen() {
            if (state.selectedCharacterIndex === null) return;

            const character = characters[state.selectedCharacterIndex];
            characterNameEl.textContent = character.name;
            characterHeaderEl.className = `text-center p-4 rounded-lg mb-6 border-2 ${character.color} ${character.bgColor}`;

            statsContainer.innerHTML = '';
            let isDead = false;

            for (const statKey in character.stats) {
                const statData = character.stats[statKey];
                const currentIndex = state.currentStatIndices[statKey];
                
                if (currentIndex === 0) {
                    isDead = true;
                }

                const statWrapper = document.createElement('div');
                statWrapper.className = `p-3 rounded-lg bg-gray-800 border border-gray-700`;

                let valuesHTML = statData.scale.map((value, index) => {
                    const isCurrent = index === currentIndex;
                    const isStart = index === statData.start;
                    const isSkull = index === 0;
                    let classes = 'stat-value inline-block text-center w-8 h-8 leading-8 rounded-full text-gray-400';
                    if (isCurrent) classes += ' current-value text-white bg-gray-600';
                    if (isStart) classes += ' start-value text-green-400';
                    if(isSkull) classes += ' skull-value text-red-500';
                    return `<div class="${classes}">${value}</div>`;
                }).join('');

                const canDecrease = state.hauntStarted ? currentIndex > 0 : currentIndex > 1;
                const canIncrease = currentIndex < statData.scale.length - 1;

                statWrapper.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-lg font-bold">${statData.name}</h4>
                        <div class="flex items-center space-x-2">
                            <button class="bg-red-600 text-white rounded-full w-8 h-8 font-bold text-2xl leading-none flex items-center justify-center ${!canDecrease ? 'btn-disabled' : 'hover:bg-red-500'}" data-stat="${statKey}" data-op="decrease" ${!canDecrease ? 'disabled' : ''}>-</button>
                            <button class="bg-green-600 text-white rounded-full w-8 h-8 font-bold text-2xl leading-none flex items-center justify-center ${!canIncrease ? 'btn-disabled' : 'hover:bg-green-500'}" data-stat="${statKey}" data-op="increase" ${!canIncrease ? 'disabled' : ''}>+</button>
                        </div>
                    </div>
                    <div class="flex justify-center space-x-1 flex-wrap">${valuesHTML}</div>
                `;
                statsContainer.appendChild(statWrapper);
            }
            
            characterStatusEl.textContent = isDead ? '角色已死亡' : '';
        }

        // --- 事件处理函数 ---

        function selectCharacter(index) {
            state.selectedCharacterIndex = index;
            const character = characters[index];
            for (const statKey in character.stats) {
                state.currentStatIndices[statKey] = character.stats[statKey].start;
            }
            
            // 重置作祟开关状态和视觉效果
            state.hauntStarted = false;
            hauntToggle.checked = false;
            if (hauntToggleDot) {
                hauntToggleDot.style.transform = 'translateX(0)';
            }
            if (hauntToggleBg) {
                hauntToggleBg.classList.remove('bg-red-600');
                hauntToggleBg.classList.add('bg-gray-600');
            }
            if(hauntLabel) {
                hauntLabel.classList.remove('text-red-500');
                hauntLabel.classList.add('text-gray-400');
            }


            renderTrackerScreen();
            selectionScreen.classList.add('hidden');
            trackerScreen.classList.remove('hidden');
        }
        
        function handleCharacterSelection(e) {
            const card = e.target.closest('.character-card');
            if (card && characterList.contains(card)) {
                const index = card.dataset.index;
                if (index !== null) {
                    selectCharacter(parseInt(index, 10));
                }
            }
        }

        function handleBackToSelection() {
            state.selectedCharacterIndex = null;
            selectionScreen.classList.remove('hidden');
            trackerScreen.classList.add('hidden');
        }

        function handleStatChange(e) {
            const button = e.target.closest('button');
            if (!button) return;

            const statKey = button.dataset.stat;
            const operation = button.dataset.op;

            if (!statKey || !operation) return;

            let currentIndex = state.currentStatIndices[statKey];

            if (operation === 'increase') {
                currentIndex++;
            } else if (operation === 'decrease') {
                currentIndex--;
            }
            
            const maxIndex = characters[state.selectedCharacterIndex].stats[statKey].scale.length - 1;
            if (currentIndex < 0) currentIndex = 0;
            if (currentIndex > maxIndex) currentIndex = maxIndex;

            state.currentStatIndices[statKey] = currentIndex;
            renderTrackerScreen();
        }

        function handleHauntToggle() {
            state.hauntStarted = hauntToggle.checked;
            
            // 更新开关的视觉效果
            if (state.hauntStarted) {
                hauntToggleBg.classList.remove('bg-gray-600');
                hauntToggleBg.classList.add('bg-red-600');
                hauntLabel.classList.remove('text-gray-400');
                hauntLabel.classList.add('text-red-500');
                hauntToggleDot.style.transform = 'translateX(100%)';
            } else {
                hauntToggleBg.classList.remove('bg-red-600');
                hauntToggleBg.classList.add('bg-gray-600');
                hauntLabel.classList.remove('text-red-500');
                hauntLabel.classList.add('text-gray-400');
                hauntToggleDot.style.transform = 'translateX(0)';
            }
            
            renderTrackerScreen(); // 重新渲染以更新按钮状态
        }


        // --- 初始化和事件监听 ---
        document.addEventListener('DOMContentLoaded', () => {
            renderSelectionScreen();

            characterList.addEventListener('click', handleCharacterSelection);
            
            backButton.addEventListener('click', handleBackToSelection);
            statsContainer.addEventListener('click', handleStatChange);
            hauntToggle.addEventListener('change', handleHauntToggle);
        });

    </script>
</body>
</html>
